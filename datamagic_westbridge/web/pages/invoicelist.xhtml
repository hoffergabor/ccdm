<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	template="/pages/template.xhtml">


	<ui:define name="body">
		<div class="content">
			<h:form id="invoiceform" target="mywindow">
				<p:panel styleClass="gradpanel" id="panel">
					<div class="innerPanel">
						<p:dataTable selectionMode="single" rows="10" paginator="true"
							paginatorPosition="top" style="text-align:left"
							value="#{invoiceserviceController.data.invoice}" var="data"
							id="invoiceTable" emptyMessage="#{msg.NODATA}" dynamic="true"
							onselectComplete="callmethod()" update="invoiceitemTable"
							paginatorAlwaysVisible="false"
							selection="#{invoiceserviceController.data.selectedInvoice}">
							<p:column sortBy="#{data.kimeno}" style="min-width:30px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_INOUT}" />
								</f:facet>
								<h:graphicImage
									url="#{data.kimeno ? '../img/kimeno.png' : '../img/bejovo.png'}" />
							</p:column>
							<p:column sortBy="#{data.sorszam}" styleClass="bold"
								style="min-width:120px">
								<f:facet name="header">
									<h:outputText value="#{msg.ORDERS_ORDERVIEW_ORDERNUM}" />
								</f:facet>
								<h:outputText value="#{data.sorszam}" />
							</p:column>
							<p:column sortBy="#{data.cegnev}" style="min-width:250px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_COMPANY}" />
								</f:facet>
								<h:outputText value="#{data.cegnev}" />
							</p:column>
							<p:column sortBy="#{data.telephely.nev}" style="min-width:250px">
								<f:facet name="header">
									<h:outputText value="Telephely" />
								</f:facet>
								<h:outputText value="#{data.telephely.nev}" />
							</p:column>
							<p:column sortBy="#{data.kelt}" styleClass="centerpos"
								style="min-width:100px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_FILE}" />
								</f:facet>
								<h:outputText value="#{data.kelt!='1900-01-01 00:00:00.0'? data.kelt:'-'}">
									<f:convertDateTime pattern="#{msg.DATEFORMAT3}"
										timeZone="Europe/Budapest" />
								</h:outputText>
							</p:column>
							<p:column sortBy="#{data.esedkelt}" styleClass="centerpos"
								style="min-width:120px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_DUE}" />
								</f:facet>
								<h:outputText value="#{data.esedkelt!='1900-01-01 00:00:00.0'? data.esedkelt:'-'}">
									<f:convertDateTime pattern="#{msg.DATEFORMAT3}"
										timeZone="Europe/Budapest" />
								</h:outputText>
							</p:column>
							<p:column sortBy="#{data.telj}" styleClass="centerpos"
								style="min-width:120px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_COMPLETED}" />
								</f:facet>
								<h:outputText value="#{data.telj!='1900-01-01 00:00:00.0'? data.telj:'-'}">
									<f:convertDateTime pattern="#{msg.DATEFORMAT3}"
										timeZone="Europe/Budapest" />
								</h:outputText>
							</p:column>
							<p:column sortBy="#{data.realesed}" styleClass="centerpos"
								style="min-width:120px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_WARRANT}" />
								</f:facet>
								<h:outputText value="#{data.realesed!='1900-01-01 00:00:00.0'? data.realesed:'-'}">
									<f:convertDateTime pattern="#{msg.DATEFORMAT3}"
										timeZone="Europe/Budapest" />
								</h:outputText>
							</p:column>
							<p:column sortBy="#{data.fizetve}" styleClass="centerpos"
								style="min-width:120px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_PAYMENT}" />
								</f:facet>
								<h:outputText value="#{data.fizetve!='1900-01-01 00:00:00.0'? data.fizetve:'-'}">
									<f:convertDateTime pattern="#{msg.DATEFORMAT3}"
										timeZone="Europe/Budapest" />
								</h:outputText>
							</p:column>
							<p:column sortBy="#{data.dnetto}" styleClass="rightpos"
								style="min-width:80px">
								<f:facet name="header">
									<h:outputText value="#{msg.ORDERS_ORDERVIEW_NET}" />
								</f:facet>
								<h:outputText value="#{data.netto}">
									<f:convertNumber pattern="#,##0" />
								</h:outputText><h:outputText value=" #{data.devnem}"></h:outputText>
							</p:column>
							<p:column sortBy="#{data.dbrutto}" styleClass="rightpos"
								style="min-width:80px">
								<f:facet name="header">
									<h:outputText value="#{msg.ORDERS_ORDERVIEW_GRO}" />
								</f:facet>
								<h:outputText value="#{data.brutto}">
									<f:convertNumber pattern="#,##0" />
								</h:outputText><h:outputText value=" #{data.devnem}"></h:outputText>
							</p:column>
							<p:column sortBy="#{data.fizmod}" style="min-width:100px">
								<f:facet name="header">
									<h:outputText value="#{msg.INVOICELIST_PAYMENTMODE}" />
								</f:facet>
								<h:outputText value="#{data.fizmod}" />
							</p:column>
						</p:dataTable>
					</div>


					<p:remoteCommand name="callmethod"
						onsuccess="invoiceitemwid.show()" process="@this"
						update="invoiceitemTable"
						action="#{invoiceserviceController.invoiceItemsAction}"></p:remoteCommand>


					<div class="summaryPanel">
						<h:panelGroup id="summaryPanel">
							<table width="100%" border="0" cellspacing="0" cellpadding="0">
								<tr>
									<td width="60%"><label>#{msg.ORDERS_ORDERVIEW_SUMMARY}</label>
									</td>
									<td width="20%"><label>#{msg.ORDERS_ORDERVIEW_NET}</label>
									</td>
									<td width="20%" class="last"><label>#{msg.ORDERS_ORDERVIEW_GRO}</label>
									</td>
								</tr>
								<tr>
									<td width="60%"></td>
									<td width="20%"><h:outputText
											value="#{invoiceserviceController.data.netto}">
											<f:convertNumber pattern="#,##0" />
										</h:outputText>
									</td>
									<td width="20%" class="last"><h:outputText
											value="#{invoiceserviceController.data.brutto}">
											<f:convertNumber pattern="#,##0" />
										</h:outputText>
									</td>
								</tr>
							</table>
						</h:panelGroup>
					</div>

					<div class="bottomFilterBar">
						<div class="bottomFilterBarFilters">
							<h:panelGroup>
								<p:commandButton process="@this" value="Telephelyek"
									oncomplete="partnerchoosewid.show()" update="cpp"
									rendered="#{invoiceserviceController.managedPartner!=null and !empty invoiceserviceController.managedStores}"
									actionListener="#{invoiceserviceController.showStores}"></p:commandButton>
								<div style="margin-left: 20px; margin-top: 8px; float: left;display:none">
									<h:selectBooleanCheckbox rendered="false"
										value="#{invoiceserviceController.data.out}">
										<p:ajax event="click" update="panel" process="@this"
											action="#{invoiceserviceController.showInvoice}">
										</p:ajax>
									</h:selectBooleanCheckbox>
									<label class="textcolor4" style="padding-left: 5px;">#{msg.INVOICELIST_OUT}</label>
								</div>
								<div style="margin-left: 10px; margin-top: 8px; float: left;display:none">
									<h:selectBooleanCheckbox rendered="false"
										value="#{invoiceserviceController.data.in}">
										<p:ajax event="click" update="panel" process="@this"
											action="#{invoiceserviceController.showInvoice}">
										</p:ajax>
									</h:selectBooleanCheckbox>
									<label class="textcolor4" style="padding-left: 5px;">#{msg.INVOICELIST_IN}</label>
								</div>
							</h:panelGroup>
						</div>
						<div class="bottomFilterBarDates">
							<h:panelGroup>
								<div class="bottomFilterBarDateFilter">
									<p:calendar value="#{invoiceserviceController.data.from}"
										selectListener="#{invoiceserviceController.invoiceDateFromChange}"
										pattern="#{msg.DATEFORMAT}" inputStyle="width:100px">
									</p:calendar>
								</div>
								<div class="bottomFilterBarDateFilter">
									<label class="textcolor4">
										#{msg.INVOICESTORNFIX_DATEFROM}</label>
								</div>

								<div class="bottomFilterBarDateFilter">
									<p:calendar value="#{invoiceserviceController.data.to}"
										selectListener="#{invoiceserviceController.invoiceDateToChange}"
										pattern="#{msg.DATEFORMAT}" inputStyle="width:100px">
									</p:calendar>
								</div>
								<div class="bottomFilterBarDateFilter">
									<label class="textcolor4">
										#{msg.INVOICESTORNFIX_DATETO}</label>
								</div>

								<p:commandButton process="@this" value="Szűrés"
									update="panel,message"
									actionListener="#{invoiceserviceController.invoiceDateChange}"
									styleClass="filterSubmitButton"></p:commandButton>
								<p:commandButton update="panel" styleClass="filterResetButton"
						actionListener="#{invoiceserviceController.resetAction}"
						value="reset" process="@this"></p:commandButton>
							</h:panelGroup>
						</div>
					</div>


					<h:commandLink
						disabled="#{empty invoiceserviceController.data.invoice}"
						value="#{msg.ORDERS_PRINT_BUTTON1}" styleClass="commonButtonLink"
						immediate="true" action="#{invoiceserviceController.print}" />
					<p:commandButton oncomplete="chartwid.show()" value="#{msg.CHART}" rendered="#{loginserviceController.managedUser.userType=='DM_PARTNER'}"
						update="chart,chartcalendar,summaryAll" id="chartbutton"
						process="@this"
						action="#{invoiceserviceController.createDataForChart}"
						styleClass="commonButton"></p:commandButton>
					<div class="clear"></div>
				</p:panel>

				<p:dialog id="invoiceItems" modal="false" widgetVar="invoiceitemwid"
					closable="true" styleClass="commonDialog" draggable="true"
					width="960" header="Számla tétele" showEffect="fade"
					hideEffect="fade">
					<p:dataTable style="text-align:left;" selectionMode="single"
						dynamic="true"
						value="#{invoiceserviceController.data.invoiceItems}" var="item"
						id="invoiceitemTable" emptyMessage="#{msg.NODATA}">
						<p:column sortBy="#{item.acikksz}" style="min-width:120px">
							<f:facet name="header">
								<h:outputText value="Cikkszám" />
							</f:facet>
							<h:outputText value="#{item.acikksz}" styleClass="bold" />
						</p:column>
						<p:column sortBy="#{item.amegn}" style="min-width:250px">
							<f:facet name="header">
								<h:outputText value="Megnevezés" />
							</f:facet>
							<h:outputText value="#{item.amegn}" />
						</p:column>
						<p:column sortBy="#{item.amenny}" styleClass="rightpos"
							style="min-width:80px">
							<f:facet name="header">
								<h:outputText value="Mennyiség" />
							</f:facet>
							<h:outputText value="#{item.amenny}">
								<f:convertNumber pattern="#,##0" />
							</h:outputText>
						</p:column>
						<p:column sortBy="#{item.aear}" styleClass="rightpos"
							style="min-width:80px">
							<f:facet name="header">
								<h:outputText value="Egységár" />
							</f:facet>
							<h:outputText value="#{item.aear}">
								<f:convertNumber pattern="#,##0" />
							</h:outputText>
						</p:column>
						<p:column sortBy="#{item.hnertek}" style="min-width:80px"
							styleClass="rightpos">
							<f:facet name="header">
								<h:outputText value="Nettó" />
							</f:facet>
							<h:outputText value="#{item.hnertek}">
								<f:convertNumber pattern="#,##0" />
							</h:outputText>
						</p:column>
						<p:column sortBy="#{item.aertek}" styleClass="rightpos"
							style="min-width:80px">
							<f:facet name="header">
								<h:outputText value="Áfa" />
							</f:facet>
							<h:outputText value="#{item.aertek}">
								<f:convertNumber pattern="#,##0" />
							</h:outputText>
						</p:column>
						<p:column sortBy="#{item.hbertek}" styleClass="rightpos"
							style="min-width:80px">
							<f:facet name="header">
								<h:outputText value="Bruttó" />
							</f:facet>
							<h:outputText value="#{item.hbertek}">
								<f:convertNumber pattern="#,##0" />
							</h:outputText>
						</p:column>
					</p:dataTable>
				</p:dialog>

				<p:dialog id="commonDialog" modal="false" widgetVar="chartwid"
					closable="true" styleClass="commonDialog" draggable="true"
					header="Grafikon" width="720">
					<br />
					<p:lineChart value="#{invoiceserviceController.data.chartInList}"
						id="chart" var="data" xfield="#{data[1]}" width="700px">
						<p:chartSeries label="Bejovo" value="#{data[2]}" />
					</p:lineChart>

					<div class="chartSummaryPanel">
						<h:panelGroup id="summaryAll">
							<div class="summaryPanel">
								<table width="100%" border="0" cellspacing="0" cellpadding="0">
									<tr>
										<td width="20%"><label>#{msg.INVOICEIN_TITLE}</label>
										</td>
										<td width="20%"><label>#{msg.ALL}:</label>
										</td>
										<td width="20%"><label>#{msg.SIDEBAR_DEBITTEXT_TITLE}</label>
										</td>
										<td width="20%"><label>#{msg.PAYED}:</label>
										</td>
										<td width="20%" class="last"><label>#{msg.EXPIRED}:</label>
										</td>
									</tr>
									<tr>
										<td width="20%"></td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.sumIn}"
												style="color:#e6c44c">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.debitIn}"
												style="color:#e6c44c">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.payedIn}"
												style="color:#e6c44c">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%" class="last"><h:outputText
												value="#{invoiceserviceController.data.expiredIn}"
												style="color:#e6c44c">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
									</tr>
								</table>
							</div>
							<div class="summaryPanel">
								<table width="100%" border="0" cellspacing="0" cellpadding="0">
									<tr>
										<td width="20%"><label>#{msg.INVOICEOUT_TITLE}</label>
										</td>
										<td width="20%"><label>#{msg.ALL}:</label>
										</td>
										<td width="20%"><label>#{msg.SIDEBAR_DEBITTEXT_TITLE}</label>
										</td>
										<td width="20%"><label>#{msg.PAYED}:</label>
										</td>
										<td width="20%" class="last"><label>#{msg.EXPIRED}:</label>
										</td>
									</tr>
									<tr>
										<td width="20%"></td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.sumOut}"
												style="color:#6584a8">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.debitOut}"
												style="color:#6584a8">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%"><h:outputText
												value="#{invoiceserviceController.data.payedOut}"
												style="color:#6584a8">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
										<td width="20%" class="last"><h:outputText
												value="#{invoiceserviceController.data.expiredOut}"
												style="color:#6584a8">
												<f:convertNumber pattern="#,##0" />
											</h:outputText>
										</td>
									</tr>
								</table>
							</div>
						</h:panelGroup>
					</div>
					<h:panelGroup id="chartcalendar">
						<br />
						<div style="margin-right: 20px; float: left;">
							<p:calendar pattern="#{msg.DATEFORMAT}" id="chartFrom"
								value="#{invoiceserviceController.data.chartFrom}"
								selectListener="#{invoiceserviceController.invoiceChartDateFromChange}"
								onSelectUpdate="chart" inputStyle="width:100px">
							</p:calendar>
							<label class="textcolor4">
								#{msg.INVOICESTORNFIX_DATEFROM}</label>
						</div>
						<div style="margin-right: 20px; float: left;">
							<p:calendar pattern="#{msg.DATEFORMAT}" id="chartTo"
								value="#{invoiceserviceController.data.chartTo}"
								selectListener="#{invoiceserviceController.invoiceChartDateToChange}"
								onSelectUpdate="chart" inputStyle="width:100px">
							</p:calendar>
							<label class="textcolor4"> #{msg.INVOICESTORNFIX_DATETO}</label>
						</div>
					</h:panelGroup>
				</p:dialog>

				<p:dialog widgetVar="partnerchoosewid" modal="false" closable="true"
					styleClass="commonDialog" draggable="true"
					header="Válassza ki a partnert" resizable="false">
					<h:panelGroup id="cpp">
						<div class="choosepartner-sales-form">
							<div class="popupSearch">
								<h:inputText styleClass="input"
									value="#{invoiceserviceController.data.partnerSearchText}"></h:inputText>
								<p:commandButton value="Keresés" update="cpp"
									styleClass="popupSearchButton"
									action="#{invoiceserviceController.searchPartnerAction}" />
							</div>
							<div class="partnerSearchList"
								style="width: 265px; height: 410px; overflow-x: hidden; overflow-y: scroll; border: 1px solid #ccc; padding: 5px; margin-bottom: 20px; background: #eee;">
								<ui:repeat value="#{invoiceserviceController.data.allPartner}"
									var="data" id="partners">
									<p:commandLink value="#{data[0]}" update="panel"
										process="@this" oncomplete="showstore()">
										<f:setPropertyActionListener value="#{data[1]}"
											target="#{invoiceserviceController.data.selectedPartnerId}" />
									</p:commandLink>
									<br />
								</ui:repeat>
							</div>
						</div>
					</h:panelGroup>
				</p:dialog>

				<p:remoteCommand name="showstore"
					action="#{invoiceserviceController.submitChooseStore}"
					oncomplete="partnerchoosewid.hide()" update="panel" process="@this"></p:remoteCommand>


				<p:growl id="message" showDetail="true" sticky="false" life="4000"
					showSummary="true" />



				<script type="text/javascript">
					function newWindow() {
						window.open('', 'mywindow', 'width=1000,height=700');
						return false;
					}
				</script>

			</h:form>
		</div>

		<div class="helpContent" onclick="RemoveHelp();"
			id="help">
			<div class="headerHelp"></div>
			<div class="menuHelp">
				<div class="helpBubble"
					style="top: 100px; left: 390px; border-top-left-radius: 0; -moz-border-radius-topleft: 0; -webkit-border-top-left-radius: 0;">
					A <strong>SZÁMLÁK</strong> menüpontban van, itt láthatja összes
					telephelye számláit, illetve megnézheti azok részleteit, egyes
					időszakokra összegzést.
				</div>
			</div>
			<div class="contentHelp">
				<div class="helpBubble"
					style="top: 300px; left: 390px; border-top-right-radius: 0; -moz-border-radius-topright: 0; -webkit-border-top-right-radius: 0;">
					Ebben a listában láthatja a dátum szűrés eredményét, <strong>egy
						adott időszakon belüli számláinak listáját.</strong>
				</div>
			</div>
			<div class="contentHelp">
				<div class="helpBubble"
					style="top: 560px; left: 300px; border-bottom-left-radius: 0; -moz-border-radius-bottomleft: 0; -webkit-border-bottom-left-radius: 0;">
					A dátumok beállításával meghatározhatja melyik időszak számláit
					szeretné megtekinteni</div>
			</div>
			<div class="footerHelp">
				<div class="helpBubble"
					style="top: 550px; right: 80px; border-bottom-right-radius: 0; -moz-border-radius-bottomright: 0; -webkit-border-bottom-right-radius: 0;">
					Ki<strong>NYOMTAT</strong>hatja az éppen látható listát, illetve
					megtekintheti az elmúlt egy év havi összegzéseit <strong>GRAFIKON</strong>on.
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>