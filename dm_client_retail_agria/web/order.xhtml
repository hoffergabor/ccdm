<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui" template="template.xhtml">

	<ui:define name="body">
		<div class="wrapper100 registrationContent">
			<div class="wrapper">

				<div class="registrationContentLeft">
					<h3>Fontos információ</h3>
					<div class="innerText">
						<img src="img/asterisk.png" class="infoIcon" />
						<p>
							<a href="/agria/adatvedelem" target="_blank">Adatvédelmi nyiltkozat</a>
						</p>
						<p>
							<a href="/agria/vasarlasiszerzodes" target="_blank">Vásárlási szerződés</a>
						</p>
					</div>
				</div>

				<h:form id="orderform">
					<div class="registrationContentCenter">
						<p:wizard flowListener="#{orderController.onFlowProcess}" 
							widgetVar="wiz" backLabel="Vissza" nextLabel="Következő">
							<p:tab id="shipping" title="1. Szállítás">
								<h:panelGroup id="shippingdata">
									<div class="orderShippingRadio">
										<h:selectOneRadio required="true" id="shippingoption"
											value="#{orderController.data.shippingOption}"
											requiredMessage="Kérem válasszon a szállítási lehetőségek közül!">
											<f:selectItem itemValue="1" itemLabel="Csomagküldő szolgálat" />
											<f:selectItem itemValue="2" itemLabel="Futár (expressz szállítás)" />
											<p:ajax event="change" update="shippingdata,message"
												process="@this"
												actionListener="#{orderController.changeShippingOption}" />
										</h:selectOneRadio>
									</div>
									<p:message for="shippingoption" display="text"></p:message>
									<label>Szállítási cím megnevezés: <h:selectOneMenu
											value="#{orderController.data.shippingAddressId}">
											<f:selectItem itemLabel="--- Kérem válasszon! ---"
												itemValue="" />
											<f:selectItems
												value="#{orderController.data.shippingAddresses}" var="data"
												itemLabel="#{data.name}" itemValue="#{data.shippingId}" />
											<p:ajax
												actionListener="#{orderController.changeShippingAddress}"
												event="change" update="shippingdata,errormsg,message" />
										</h:selectOneMenu> </label>
									<label>Név:<h:inputText required="true"
											requiredMessage="Szállítás neve megadása kötelező!"
											id="shippingname"
											value="#{orderController.data.shippingAddress.name}" /> <p:message
											for="shippingname" display="text" /> </label>
									<label>Irányítószám:<h:inputText maxlength="4" size="2"
											required="true"
											requiredMessage="Irányítószám megadása kötelező!"
											id="zipcode"
											value="#{orderController.data.shippingAddress.zipCode}">
											<p:ajax update="errormsg,message,shippBottom" event="change"
												global="false" process="@this"
												actionListener="#{orderController.changeZipCode}" />
										</h:inputText> <p:message for="zipcode" display="text" /> </label>
									<label>Település:<p:autoComplete id="town"
											required="true" queryDelay="0" maxResults="23"
											requiredMessage="Település megadása kötelező!"
											completeMethod="#{orderController.completeTown}"
											value="#{orderController.data.shippingAddress.townShip}"></p:autoComplete>
										<p:message for="town" display="text" /> </label>
									<label>Cím:<h:inputText id="address" required="true"
											requiredMessage="Cím megadása kötelező!"
											value="#{orderController.data.shippingAddress.address}" /> <p:message
											for="address" display="text" /> </label>
									<label>Árut átvevő személy neve:<h:inputText
											id="shipcontact" required="true"
											requiredMessage="Árut átvevő személy megadása kötelező!"
											value="#{orderController.data.shippingAddress.contactName}" />
										<p:message for="shipcontact" display="text" /> </label>
									<label>Megjegyzés:<h:inputTextarea rows="5" cols="30"
											value="#{orderController.data.shippingAddress.comment}" /> </label>
									<div class="clear"></div>
									<h:panelGroup id="shippBottom">
										<h:panelGroup id="shipp"
											rendered="#{orderController.data.shippingPrice!=null}">
											<div class="cartSummary">
												<span>Házhozszállítás díja:</span> <b><h:outputText
														value="#{orderController.data.shippingPrice}" /> Ft</b>
											</div>
										</h:panelGroup>
										<h:panelGroup id="shippdate"
											rendered="#{orderController.data.shippingDate!=null}">
											<div class="cartSummary">
												<span>Szállítás időpontja:</span> <b><h:outputText
														value="#{orderController.data.shippingDate}">
														<f:convertDateTime pattern="#{msg.DATEFORMAT}"
															timeZone="Europe/Budapest" />
													</h:outputText> </b>
											</div>
										</h:panelGroup>
									</h:panelGroup>
									<div class="clear"></div>
									<div class="cartSummary">
										<b> <h:outputText
												value="#{orderController.data.errorMessage}" id="errormsg"
												rendered="#{orderController.data.errorMessage!=null}"></h:outputText>
										</b>
									</div>
									<div class="clear"></div>
									<p:commandButton value="Vissza a kosárhoz" action="cart"
										styleClass="backToCart" immediate="true"
										rendered="#{orderController.data.errorMessage!=null}"></p:commandButton>
								</h:panelGroup>
							</p:tab>
							<p:tab id="pay" title="2. Fizetés">
								<div class="orderPaymentRadio">
									<h:selectOneRadio layout="pageDirection" required="true"
										value="#{orderController.data.payOption}"
										requiredMessage="Kérjük adja meg a fizetés típusát!"
										id="paytypes">
										<f:selectItem itemValue="Készpénz" itemLabel="Utánvétel" />
										<f:selectItem itemValue="Átutalás" itemLabel="Előre utalás" />
										<f:selectItem itemValue="Paypal"
											itemLabel="Kártyás fizetés - Paypal" />
<!-- 										<f:selectItem itemValue="Kártyás" itemLabel="Kártyás fizetés" /> -->
										<p:ajax event="change" process="@this" />
									</h:selectOneRadio>
								</div>
								<h:panelGroup id="invoicepanel">
									<label>Kér számlát:<h:selectOneRadio id="invoicecheck"
											immediate="true"
											value="#{orderController.data.activateInvoice}">
											<f:selectItem itemLabel="Nem" itemValue="0" />
											<f:selectItem itemLabel="Igen" itemValue="1" />
											<p:ajax event="change" update="invoicepanel" process="@this" />
										</h:selectOneRadio> </label>
									<h:panelGroup
										rendered="#{orderController.data.activateInvoice==1}">
										<p:commandButton value="Szállítási adatok másolása"
											immediate="true" update="invoicepanel" process="@this"
											styleClass="copyShippingAddress"
											rendered="#{orderController.data.shippingOption==1}"
											actionListener="#{orderController.copyShippingDatas}"></p:commandButton>
										<label>Számlázási név: <h:inputText maxlength="50"
												required="true" id="invoicename"
												requiredMessage="Számlázási név megadása kötelező!"
												value="#{orderController.data.invoiceName}"></h:inputText> </label>
										<label>Irányítószám:<h:inputText maxlength="4"
												size="2" required="true"
												requiredMessage="Irányítószám megadása kötelező!"
												id="zipcode2" value="#{orderController.data.invoiceZipcode}" />
										</label>
										<label>Település:<p:autoComplete id="town2"
												required="true" queryDelay="0" maxlength="30"
												requiredMessage="Település megadása kötelező!" maxResults="23"
												completeMethod="#{registrationController.completeTown}"
												value="#{orderController.data.invoiceCity}"></p:autoComplete>
										</label>
										<label>Cím:<h:inputText id="address2" required="true"
												requiredMessage="Cím megadása kötelező!" maxlength="50"
												value="#{orderController.data.invoiceAddress}" /> </label>
									</h:panelGroup>
									<p:messages showDetail="true" showSummary="false"></p:messages>
								</h:panelGroup>
							</p:tab>
							<p:tab id="summary" title="3. Összegzés">
								<p:dataGrid var="data" value="#{cartController.data.items}"
									effect="true" id="itemTable" columns="1">
									<p:column>
										<div class="cartGridElement">
											<div class="cartGridPicture">
												<center>
													<img
														onerror="this.src='${facesContext.externalContext.requestContextPath}/img/placeholder.png'"
														src="http://coandco.iboard.hu/agria/#{data.cikkszam}.jpg"
														height="50" />
												</center>
											</div>
											<div class="cartGridName">
												<table>
													<tr>
														<td style="" valign="middle" height="52"><h:outputText
																value="#{data.megn}" /></td>
													</tr>
												</table>
											</div>
											<div class="cartGridCount">
												<h:outputText value="#{data.menny}" />
												db
											</div>
											<div class="cartGridPrice">
												<h:outputText value="#{data.brutto}">
													<f:convertNumber type="number" maxFractionDigits="0" />
												</h:outputText>
												Ft
											</div>
											<div class="cartGridGrossPrice">
												<h:outputText value="#{data.menny*data.brutto}">
													<f:convertNumber type="number" maxFractionDigits="0" />
												</h:outputText>
												Ft
											</div>
										</div>
									</p:column>
								</p:dataGrid>

								<div class="cartSummary">
									<span>Fizetendő végösszeg:</span><b><h:outputText
											value="#{cartController.data.allBrutto}">
											<f:convertNumber type="number" maxFractionDigits="0" />
										</h:outputText> Ft </b>
								</div>
								<div class="clear"></div>
								<h:panelGroup>
									<div class="cartSummary">
										<span> Házhozszállítás díja:</span> <b><h:outputText
												value="#{orderController.data.shippingPrice}">
												<f:convertNumber type="number" maxFractionDigits="0" />
											</h:outputText> Ft</b>
									</div>
									<div class="clear"></div>
								</h:panelGroup>
								<div class="cartSummary">
									<span>Fizetés:</span> <b>#{orderController.data.payOption}</b>
								</div>
								<div class="clear"></div>
								<div class="cartSummary">
									<span>Szállítás:</span> <b>#{orderController.data.shippingOption==1?'Házhozszállítás':
										'Telephelyen történő átvétel'} </b>
								</div>
								<div class="clear"></div>
								<div class="cartSummaryRules">
									<h:selectBooleanCheckbox id="rules"
										value="#{orderController.data.rules}">
										<p:ajax event="change" update="rules"></p:ajax>
									</h:selectBooleanCheckbox>
									Elfogadom a <a
										href="${facesContext.externalContext.requestContextPath}/vasarlasiszerzodes"
										target="_blank">vásárlási feltételeket</a>
								</div>
								<div class="clear"></div>
								<p:commandButton value="Megrendelem" immediate="true"
									update="message,header:headerform:headercartdatas"
									action="#{orderController.saveOrder}"
									rendered="#{orderController.data.payOption!='Paypal'}"></p:commandButton>
								<p:commandButton immediate="true" ajax="false"
									styleClass="paypalButton" value="Megrendelem"
									rendered="#{orderController.data.payOption=='Paypal'}"
									update="message,header:headerform:headercartdatas"
									action="#{orderController.saveOrder}">
								</p:commandButton>
							</p:tab>
						</p:wizard>
					</div>
					<p:growl id="message" showDetail="true" sticky="false" life="4000"
						showSummary="false" />
				</h:form>
			</div>
			<div class="clear"></div>
		</div>
	</ui:define>
</ui:composition>